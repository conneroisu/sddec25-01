
name: Build Preview
 
on:
  pull_request:
    paths:
      - '**.tex'
      - '**.bib'
      - '**.cls'
      - 'flake.nix'
      - 'flake.lock'
      - '.github/workflows/build-preview.yml'
 
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
 
    steps:
      - uses: actions/checkout@v4
 
      - name: Install Nix
        uses: cachix/install-nix-action@v27
        with:
          extra_nix_config: |
            experimental-features = nix-command flakes
 
      - name: Build main document
        run: nix develop .#ci -c ltx-compile main.tex
 
      - name: Build poster
        run: nix develop .#ci -c ltx-compile poster/poster.tex
 
      - name: Upload PDFs
        uses: actions/upload-artifact@v4
        with:
          name: documents-pr${{ github.event.pull_request.number }}
          path: |
            main.pdf
            poster/poster.pdf
 
      - name: Update PR comment
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: build-preview
          message: |
            ## ğŸ“„ Build Preview
 
            âœ… Documents built successfully!
 
            **[â¬‡ï¸ Download PDFs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})**
 
            This artifact contains:
            - ğŸ“˜ `main.pdf` - Design document
            - ğŸ–¼ï¸ `poster.pdf` - A0 poster
 
            <sub>Build #${{ github.run_number }} from commit `${{ github.event.pull_request.head.sha }}`</sub>
